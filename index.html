<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë¶€ìš¸í¬ ë£°ë ›ê²Œì„</title>
<meta property="og:title" content="ë¶€ìš¸í¬ ë£°ë ›ê²Œì„" />
<meta property="og:description" content="SPINì„ ëˆ„ë¥´ë©´ 3ì´ˆ íšŒì „ í›„ ë‹¹ì²¨!" />
<meta property="og:image" content="hadong_thumbnail.png" />
<meta name="theme-color" content="#0b1220" />
<style>
  :root { color-scheme: dark; }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#e5e7eb}
  .wrap{max-width:980px;margin:28px auto;padding:0 16px}
  h1{margin:0 0 8px;font-weight:800}
  .sub{color:#9aa4b2;margin-bottom:16px}
  .board{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
  @media (max-width:980px){.board{grid-template-columns:1fr}}
  .card{background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .pointer{width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #facc15;margin:0 auto 8px;filter:drop-shadow(0 4px 10px rgba(0,0,0,.6))}
  canvas{display:block;margin:0 auto;max-width:100%;background:radial-gradient(circle at 50% 50%, #091022 0 34%, transparent 34% 100%);border-radius:50%;border:10px solid #1f2937}
  .controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{border:0;border-radius:999px;padding:10px 16px;font-weight:800;cursor:pointer}
  .result{font-size:20px;font-weight:800;margin-top:6px}
  .list{display:grid;gap:8px}
  .pill{padding:10px 12px;border:1px solid #334155;border-radius:12px;display:flex;align-items:center;justify-content:space-between;background:#0b1326}
  .pill small{color:#93a3b8}
  .badge{padding:4px 8px;border-radius:999px;font-size:12px;font-weight:800;background:#064e3b;color:#86efac}
  .note{font-size:13px;color:#9aa4b2}
</style>
</head>
<body>
  <div class="wrap">
    <h1>ë¶€ìš¸í¬ ë£°ë ›ê²Œì„</h1>
    <div class="sub">ëŒ€ìƒì 8ëª… Â· ì´ 20ê²Œì„ Â· 1ì¸ë‹¹ ê¸°ë³¸ ìµœëŒ€ 2íšŒ ë‹¹ì²¨ Â· <b>4ê²Œì„ì€ ì œí•œ í•´ì œ</b>(2íšŒ ì´ˆê³¼ í—ˆìš©). SPINì„ ëˆ„ë¥´ë©´ <b>3ì´ˆ</b> íšŒì „ í›„ <b>ìƒë‹¨ í™”ì‚´í‘œ</b>ê°€ ê°€ë¦¬í‚¤ëŠ” ì‚¬ëŒì´ ë‹¹ì²¨ë©ë‹ˆë‹¤.</div>

    <div class="board">
      <div class="card">
        <div class="pointer"></div>
        <canvas id="wheel" width="560" height="560" aria-label="ë£°ë ›"></canvas>
        <div class="controls">
          <button id="spin"  style="background:#22c55e;color:#052e16;">SPIN</button>
          <button id="reset" style="background:#38bdf8;color:#082f49;">RESET</button>
          <button id="saveThumb" style="background:#f59e0b;color:#3b2600;">ì¸ë„¤ì¼ PNG ì €ì¥</button>
          <button id="mute" style="background:#6b7280;color:#111827;">ğŸ”Š ì†Œë¦¬ ì¼œì§</button>
          <div class="result" id="result">â€”</div>
        </div>
        <div class="note" id="progressNote" style="margin-top:6px;">ì§„í–‰: 0 / 20 Â· ì œí•œí•´ì œ ë‚¨ìŒ: 4</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px;">ì°¸ê°€ì (8ëª…)</h3>
        <div class="list" id="nameList"></div>
        <p class="note" style="margin-top:12px;">ê° ì´ë¦„ ì˜¤ë¥¸ìª½ ìˆ«ìëŠ” í˜„ì¬ ë‹¹ì²¨ íšŸìˆ˜ì…ë‹ˆë‹¤. (ê¸°ë³¸ ìƒí•œ 2íšŒ, ì œí•œí•´ì œ ê²Œì„ì—ì„œëŠ” ì´ˆê³¼ ê°€ëŠ¥)</p>
      </div>
    </div>
  </div>

<script>
/* ===== ì„¤ì • ===== */
const NAMES = [
  "ê¹€ë´‰ì˜","ê¹€ê¸°ëª©","ê¹€í™”ê·œ","ê¹€ì–µí™˜",
  "ê¹€ì˜ìˆœ","ì´ì§€ì˜¤","í•œì„ ì¼","í•¨ë¶€ì‹"
];
const MAX_SPINS = 20;   // ì´ ê²Œì„ ìˆ˜
const MAX_PER   = 2;    // ê¸°ë³¸ 1ì¸ë‹¹ ìµœëŒ€ ë‹¹ì²¨
const FLEX_SPINS_TOTAL = 4; // ì œí•œ í•´ì œ ê²Œì„ ìˆ˜(ì •í™•íˆ 4íšŒ)

/* ===== ìƒíƒœ ===== */
let spinNumber = 0; // 0ë¶€í„° ì‹œì‘ (í‘œì‹œëŠ” +1)
let flexSpinsLeft = FLEX_SPINS_TOTAL;
const winCounts = Object.fromEntries(NAMES.map(n=>[n,0]));
// 1..20 ì¤‘ 4ê°œë¥¼ ë¬´ì‘ìœ„ë¡œ ë½‘ì•„ ì œí•œí•´ì œ íšŒì°¨ë¡œ ì§€ì •(ì¬ë¡œë“œë§ˆë‹¤ ì„ì„)
const flexRounds = (()=>{
  const arr = Array.from({length:MAX_SPINS},(_,i)=>i+1);
  for (let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return new Set(arr.slice(0,FLEX_SPINS_TOTAL));
})();

/* ===== ìº”ë²„ìŠ¤/ë Œë” ===== */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const r = canvas.width/2;
const center = { x:r, y:r };
const seg = (2*Math.PI)/NAMES.length;
let angle = 0;

/* 8ìƒ‰ (ê°ê¸° ë‹¤ë¥¸ ì»¬ëŸ¬) */
const COLORS = [
  "#ef4444","#3b82f6","#22c55e","#eab308",
  "#a855f7","#06b6d4","#f97316","#10b981"
];

function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(center.x, center.y);
  ctx.rotate(angle);
  ctx.translate(-center.x, -center.y);

  for (let i=0;i<NAMES.length;i++){
    const start = -Math.PI/2 + i*seg;
    const end   = start + seg;
    ctx.beginPath();
    ctx.moveTo(center.x, center.y);
    ctx.arc(center.x, center.y, r-6, start, end);
    ctx.closePath();
    ctx.fillStyle = COLORS[i % COLORS.length];
    ctx.fill();
    ctx.strokeStyle = '#1f2937';
    ctx.lineWidth = 2;
    ctx.stroke();

    // í…ìŠ¤íŠ¸ (êµµê²Œ/í¬ê²Œ + í°ìƒ‰ ì™¸ê³½ì„  + ê²€ì • ì±„ì›€)
    const mid = (start+end)/2;
    const tx = center.x + Math.cos(mid) * (r*0.68);
    const ty = center.y + Math.sin(mid) * (r*0.68);
    ctx.save();
    ctx.translate(tx, ty);
    ctx.rotate(mid + Math.PI/2);
    ctx.font = 'bold 18px system-ui';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.lineWidth = 4; ctx.strokeStyle = '#ffffff';
    ctx.strokeText(NAMES[i], 0, 0);
    ctx.fillStyle = '#000000';
    ctx.fillText(NAMES[i], 0, 0);
    ctx.restore();
  }

  // ì¤‘ì‹¬ ì¥ì‹
  ctx.beginPath();
  ctx.arc(center.x, center.y, 24, 0, 2*Math.PI);
  ctx.fillStyle = '#0ea5e9';
  ctx.fill();
  ctx.lineWidth = 8; ctx.strokeStyle = '#091022'; ctx.stroke();

  ctx.restore();
}

function getSelectedIndex(){
  const twoPi = 2*Math.PI;
  const norm = ((angle % twoPi) + twoPi) % twoPi;
  const atTop = (twoPi - norm); // ìœ„ìª½ ê¸°ì¤€
  return Math.floor((atTop + seg/2) / seg) % NAMES.length;
}

/* ===== ì˜¤ë””ì˜¤ (ê²½ì¾Œ í†¤) ===== */
let audioCtx=null, spinningOsc=null, spinGain=null, muted=false, lastTickIndex=null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
function startSpinSound(){ if (muted) return; ensureAudio(); stopSpinSound(); spinningOsc = audioCtx.createOscillator(); spinGain = audioCtx.createGain(); spinningOsc.type='square'; spinningOsc.frequency.value=440; spinGain.gain.value=0.03; spinningOsc.connect(spinGain).connect(audioCtx.destination); spinningOsc.start(); }
function modulateSpinSound(v){ if(!spinningOsc) return; const freq=300+Math.min(700,v*90); spinningOsc.frequency.setTargetAtTime(freq,audioCtx.currentTime,0.05); const g=0.015+Math.min(0.05,v*0.004); spinGain.gain.setTargetAtTime(muted?0:g,audioCtx.currentTime,0.05); }
function stopSpinSound(){ if(spinningOsc){try{spinningOsc.stop();}catch(e){} spinningOsc.disconnect(); spinningOsc=null;} if(spinGain){try{spinGain.disconnect();}catch(e){} spinGain=null;} }
function playWinSound(){ if(muted) return; ensureAudio(); const notes=[523.25,659.25,783.99,987.77]; const t0=audioCtx.currentTime; notes.forEach((f,i)=>{ const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='triangle'; o.frequency.value=f; g.gain.value=0.0001; o.connect(g).connect(audioCtx.destination); const st=t0+i*0.1; o.start(st); g.gain.linearRampToValueAtTime(0.06,st+0.02); g.gain.exponentialRampToValueAtTime(0.0001,st+0.28); o.stop(st+0.3); }); }
function playTickSound(){ if(muted) return; ensureAudio(); const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='square'; o.frequency.value=1500; g.gain.value=0.0001; o.connect(g).connect(audioCtx.destination); const t=audioCtx.currentTime; o.start(t); g.gain.linearRampToValueAtTime(0.05,t+0.005); g.gain.exponentialRampToValueAtTime(0.0001,t+0.04); o.stop(t+0.05); }

/* ===== ë‹¹ì²¨ ë¡œì§: 1ì¸ 2íšŒ ìƒí•œ + 4íšŒ ì œí•œí•´ì œ ===== */
function isFlexRound(n){ return flexRounds.has(n); }
function pickTargetIdx(){
  // í˜„ì¬ íšŒì°¨(í‘œì‹œìš©ì€ +1)
  const round = spinNumber + 1;
  const flex = isFlexRound(round);
  // í›„ë³´ ì§‘í•© êµ¬ì„±
  let candidates = [];
  if (!flex){
    candidates = NAMES.filter(n => winCounts[n] < MAX_PER);
  } else {
    candidates = NAMES.slice(); // ì œí•œí•´ì œ: ì „ì› ê°€ëŠ¥
  }
  if (candidates.length === 0){
    // ëª¨ë“  ì¸ì›ì´ 2íšŒ ì´ìƒì´ë¼ë©´ ë‚¨ì€ íšŒì°¨ëŠ” ì œí•œí•´ì œë¡œ ì²˜ë¦¬
    candidates = NAMES.slice();
  }
  const idx = Math.floor(Math.random() * candidates.length);
  const name = candidates[idx];
  return NAMES.indexOf(name);
}

/* ===== ìŠ¤í•€(3ì´ˆ ê³ ì •, ease-out) ===== */
let spinning=false, rafId=null;
function spin(){
  if (spinning) return;
  if (spinNumber >= MAX_SPINS){
    alert('20ê²Œì„ì´ ëª¨ë‘ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. RESET í›„ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.');
    return;
  }
  spinning = true;
  resultEl.textContent = 'íšŒì „ ì¤‘â€¦';
  spinBtn.disabled = true; resetBtn.disabled = true;

  ensureAudio(); startSpinSound();

  const duration = 3000; // 3ì´ˆ
  const start = performance.now();
  const startAngle = angle;
  const targetIdx = pickTargetIdx();
  const twoPi = 2*Math.PI;
  const currentNorm = ((angle % twoPi)+twoPi)%twoPi;
  const desired = ((twoPi - (targetIdx*seg)) - seg/2 + twoPi) % twoPi; // ì¤‘ì•™ ì •ë ¬
  let delta = desired - currentNorm; if (delta < 0) delta += twoPi;
  const spins = 5 * twoPi;  // 5ë°”í€´
  const endAngle = startAngle + spins + delta;

  lastTickIndex = null;

  const tick = (now) => {
    let t = (now - start) / duration; if (t > 1) t = 1;
    const eased = 1 - Math.pow(1 - t, 3); // easeOutCubic
    angle = startAngle + (endAngle - startAngle) * eased;

    const instVel = (endAngle - startAngle) / duration * (1 - t + 0.2) * 60;
    modulateSpinSound(instVel);
    const idxNow = getSelectedIndex();
    if (lastTickIndex === null) lastTickIndex = idxNow;
    if (idxNow !== lastTickIndex){ lastTickIndex = idxNow; playTickSound(); }

    drawWheel();

    if (t < 1){
      rafId = requestAnimationFrame(tick);
    } else {
      spinning = false; spinBtn.disabled = false; resetBtn.disabled = false;
      stopSpinSound();

      // ê²°ê³¼ ì²˜ë¦¬
      const winner = NAMES[targetIdx];
      showResult(targetIdx);
      playWinSound();

      // ì¹´ìš´íŠ¸ ì¦ê°€
      const round = ++spinNumber; // ë‹¤ìŒ íšŒì°¨ë¡œ ì¦ê°€
      const flex = isFlexRound(round);
      winCounts[winner] = (winCounts[winner]||0) + 1;
      if (flex) { flexSpinsLeft = Math.max(0, flexSpinsLeft - 1); }
      updateSidebar();

      if (spinNumber >= MAX_SPINS){
        resultEl.innerHTML += ' Â· <span class="badge">ì´ 20ê²Œì„ ì¢…ë£Œ</span>';
      }
    }
  };
  rafId = requestAnimationFrame(tick);
}

function reset(){
  if (spinning) return;
  angle = 0; drawWheel();
  resultEl.innerHTML = 'â€”';
  // ìƒíƒœ ì´ˆê¸°í™”
  spinNumber = 0; flexSpinsLeft = FLEX_SPINS_TOTAL;
  for (const k of Object.keys(winCounts)) winCounts[k]=0;
  updateSidebar();
}

/* ===== UI ë°”ì¸ë”© ===== */
const spinBtn  = document.getElementById('spin');
const resetBtn = document.getElementById('reset');
const resultEl = document.getElementById('result');
const progressNote = document.getElementById('progressNote');
spinBtn.addEventListener('click', spin);
resetBtn.addEventListener('click', reset);

const muteBtn = document.getElementById('mute');
muteBtn.addEventListener('click', ()=>{
  muted = !muted;
  muteBtn.textContent = muted ? 'ğŸ”‡ ì†Œë¦¬ êº¼ì§' : 'ğŸ”Š ì†Œë¦¬ ì¼œì§';
  if (muted) stopSpinSound();
});

/* ===== ì‚¬ì´ë“œë°” ëª©ë¡ ===== */
const listEl = document.getElementById('nameList');
function updateSidebar(){
  listEl.innerHTML = '';
  NAMES.forEach((n,i)=>{
    const d = document.createElement('div');
    d.className = 'pill'; d.dataset.name = n;
    const count = winCounts[n]||0;
    const limit = (count >= MAX_PER) ? ' Â· ìƒí•œ ë„ë‹¬' : '';
    d.innerHTML = `<span>${String(i+1).padStart(2,'0')}. ${n}</span><small>${count}íšŒ${limit}</small>`;
    listEl.appendChild(d);
  });
  progressNote.textContent = `ì§„í–‰: ${spinNumber} / ${MAX_SPINS} Â· ì œí•œí•´ì œ ë‚¨ìŒ: ${flexSpinsLeft}`;
}

/* ===== ê²°ê³¼ í‘œì‹œ ===== */
function showResult(idx){
  const name = NAMES[idx];
  resultEl.innerHTML = `ì„ íƒ: <span class="badge">${name}</span>`;
  document.querySelectorAll('[data-name]').forEach(el=>{
    el.style.outline = (el.dataset.name === name) ? '2px solid #22c55e' : '0';
  });
}

/* ===== ì¸ë„¤ì¼ PNG ìƒì„±(ì„ íƒì‚¬í•­) ===== */
const saveBtn = document.getElementById('saveThumb');
saveBtn?.addEventListener('click', () => {
  const w=1200, h=630;
  const c = document.createElement('canvas');
  c.width=w; c.height=h; const g=c.getContext('2d');
  const grad = g.createLinearGradient(0,0,w,h); grad.addColorStop(0,'#0b1220'); grad.addColorStop(1,'#0f172a'); g.fillStyle=grad; g.fillRect(0,0,w,h);
  const vignette = g.createRadialGradient(w/2,h/2,120, w/2,h/2,640); vignette.addColorStop(0,'rgba(0,0,0,0)'); vignette.addColorStop(1,'rgba(0,0,0,0.45)'); g.fillStyle=vignette; g.fillRect(0,0,w,h);
  g.save(); g.translate(72, 150); g.fillStyle='rgba(14,165,233,0.18)'; g.fillRect(-14,-64, 760, 108); g.fillStyle='#e5e7eb'; g.font='800 74px "Noto Sans KR", system-ui'; g.fillText('ë¶€ìš¸í¬ ë£°ë ›ê²Œì„', 0, 0); g.font='600 30px "Noto Sans KR", system-ui'; g.fillStyle='#93c5fd'; g.fillText('8ëª… Â· 20ê²Œì„ Â· 4íšŒ ì œí•œí•´ì œ', 0, 48); g.restore();
  const cx=900, cy=320, R=220, count=NAMES.length; g.save(); g.translate(cx, cy+R+18); g.scale(1,0.22); g.beginPath(); g.arc(0,0,R*0.95,0,Math.PI*2); g.fillStyle='rgba(0,0,0,0.5)'; g.fill(); g.restore();
  const ringGrad = g.createRadialGradient(cx,cy,R*0.2, cx,cy,R); ringGrad.addColorStop(0,'#d1d5db'); ringGrad.addColorStop(0.65,'#9ca3af'); ringGrad.addColorStop(1,'#6b7280'); g.beginPath(); g.arc(cx,cy,R+16,0,Math.PI*2); g.lineWidth=18; g.strokeStyle=ringGrad; g.stroke();
  for (let i=0;i<count;i++){ const start=-Math.PI/2 + i*(2*Math.PI/count), end=start+(2*Math.PI/count); g.beginPath(); g.moveTo(cx,cy); g.arc(cx,cy,R,start,end); g.closePath(); g.fillStyle = COLORS[i%COLORS.length]; g.fill(); }
  const midGrad = g.createRadialGradient(cx,cy,10, cx,cy,36); midGrad.addColorStop(0,'#e0f2fe'); midGrad.addColorStop(1,'#0ea5e9'); g.beginPath(); g.arc(cx,cy,24,0,Math.PI*2); g.fillStyle=midGrad; g.fill(); g.beginPath(); g.arc(cx-8, cy-8, 8, 0, Math.PI*2); g.fillStyle='rgba(255,255,255,0.65)'; g.fill();
  g.beginPath(); g.moveTo(cx, cy-R-22); g.lineTo(cx-20, cy-R+16); g.lineTo(cx+20, cy-R+16); g.closePath(); const ptrGrad = g.createLinearGradient(cx,cy-R-22, cx,cy-R+16); ptrGrad.addColorStop(0,'#fde68a'); ptrGrad.addColorStop(1,'#f59e0b'); g.fillStyle=ptrGrad; g.fill(); g.lineWidth=3; g.strokeStyle='rgba(0,0,0,0.35)'; g.stroke();
  const a=document.createElement('a'); a.href=c.toDataURL('image/png'); a.download='thumbnail.png'; a.click();
});

/* ì´ˆê¸° ë Œë” & ì‚¬ì´ë“œë°” ì´ˆê¸°í™” */
function initSidebar(){ listEl.innerHTML=''; NAMES.forEach((n,i)=>{ const d=document.createElement('div'); d.className='pill'; d.dataset.name=n; d.innerHTML=`<span>${String(i+1).padStart(2,'0')}. ${n}</span><small>0íšŒ</small>`; listEl.appendChild(d); }); }
initSidebar();
drawWheel();
updateSidebar();
</script>
</body>
</html>
