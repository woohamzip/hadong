<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë¶€ìš¸í¬ ë£°ë ›ê²Œì„</title>
<meta property="og:title" content="ë¶€ìš¸í¬ ë£°ë ›ê²Œì„" />
<meta property="og:description" content="SPINì„ ëˆ„ë¥´ë©´ 3ì´ˆ íšŒì „ í›„ ë‹¹ì²¨!" />
<meta property="og:image" content="https://woohamzip.github.io/hadong/hadong_thumbnail.png" />
<meta name="twitter:image" content="https://woohamzip.github.io/hadong/hadong_thumbnail.png" />
<meta name="theme-color" content="#0b1220" />
<style>
  :root { color-scheme: dark; }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b1220;color:#e5e7eb}
  .wrap{max-width:980px;margin:28px auto;padding:0 16px}
  h1{margin:0 0 8px;font-weight:800}
  .board{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
  @media (max-width:980px){.board{grid-template-columns:1fr}}
  .card{background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .pointer{width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid #facc15;margin:0 auto 8px;filter:drop-shadow(0 4px 10px rgba(0,0,0,.6))}
  canvas{display:block;margin:0 auto;max-width:100%;background:radial-gradient(circle at 50% 50%, #091022 0 34%, transparent 34% 100%);border-radius:50%;border:10px solid #1f2937}
  .controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{border:0;border-radius:999px;padding:10px 16px;font-weight:800;cursor:pointer}
  .result{font-size:20px;font-weight:800;margin-top:6px}
  .list{display:grid;gap:8px}
  .pill{padding:10px 12px;border:1px solid #334155;border-radius:12px;display:flex;align-items:center;justify-content:space-between;background:#0b1326}
  .pill small{color:#93a3b8}
  .badge{padding:4px 8px;border-radius:999px;font-size:12px;font-weight:800;background:#064e3b;color:#86efac}
</style>
</head>
<body>
  <div class="wrap">
    <h1>ë¶€ìš¸í¬ ë£°ë ›ê²Œì„</h1>

    <div class="board">
      <div class="card">
        <div class="pointer"></div>
        <canvas id="wheel" width="560" height="560" aria-label="ë£°ë ›"></canvas>
        <div class="controls">
          <button id="spin"  style="background:#22c55e;color:#052e16;">SPIN</button>
          <button id="reset" style="background:#38bdf8;color:#082f49;">RESET</button>
          <button id="mute" style="background:#6b7280;color:#111827;">ğŸ”Š ì†Œë¦¬ ì¼œì§</button>
          <div class="result" id="result">â€”</div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px;">ì°¸ê°€ì (8ëª…)</h3>
        <div class="list" id="nameList"></div>
      </div>
    </div>
  </div>

<script>
const NAMES = ["ê¹€ë´‰ì˜","ê¹€ê¸°ëª©","ê¹€í™”ê·œ","ê¹€ì–µí™˜","ê¹€ì˜ìˆœ","ì´ì§€ì˜¤","í•œì„ ì¼","í•¨ë¶€ì‹"];
const MAX_SPINS = 20;
const MAX_PER   = 2;
const FLEX_SPINS_TOTAL = 4;

let spinNumber = 0;
let flexSpinsLeft = FLEX_SPINS_TOTAL;
const winCounts = Object.fromEntries(NAMES.map(n=>[n,0]));
const flexRounds = (()=>{
  const arr = Array.from({length:MAX_SPINS},(_,i)=>i+1);
  for (let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; }
  return new Set(arr.slice(0,FLEX_SPINS_TOTAL));
})();

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const r = canvas.width/2;
const center = { x:r, y:r };
const seg = (2*Math.PI)/NAMES.length;
let angle = 0;
const COLORS = ["#ef4444","#3b82f6","#22c55e","#eab308","#a855f7","#06b6d4","#f97316","#10b981"];

function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(center.x, center.y);
  ctx.rotate(angle);
  ctx.translate(-center.x, -center.y);

  for (let i=0;i<NAMES.length;i++){
    const start = -Math.PI/2 + i*seg;
    const end   = start + seg;
    ctx.beginPath();
    ctx.moveTo(center.x, center.y);
    ctx.arc(center.x, center.y, r-6, start, end);
    ctx.closePath();
    ctx.fillStyle = COLORS[i % COLORS.length];
    ctx.fill();
    ctx.strokeStyle = '#1f2937';
    ctx.lineWidth = 2;
    ctx.stroke();

    const mid = (start+end)/2;
    const tx = center.x + Math.cos(mid) * (r*0.68);
    const ty = center.y + Math.sin(mid) * (r*0.68);
    ctx.save();
    ctx.translate(tx, ty);
    ctx.rotate(mid + Math.PI/2);
    ctx.font = 'bold 18px system-ui';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.lineWidth = 4; ctx.strokeStyle = '#ffffff';
    ctx.strokeText(NAMES[i], 0, 0);
    ctx.fillStyle = '#000000';
    ctx.fillText(NAMES[i], 0, 0);
    ctx.restore();
  }

  ctx.beginPath();
  ctx.arc(center.x, center.y, 24, 0, 2*Math.PI);
  ctx.fillStyle = '#0ea5e9';
  ctx.fill();
  ctx.lineWidth = 8; ctx.strokeStyle = '#091022'; ctx.stroke();
  ctx.restore();
}

function getSelectedIndex(){
  const twoPi = 2*Math.PI;
  const norm = ((angle % twoPi) + twoPi) % twoPi;
  const atTop = (twoPi - norm);
  return Math.floor((atTop + seg/2) / seg) % NAMES.length;
}

let audioCtx=null, spinningOsc=null, spinGain=null, muted=false, lastTickIndex=null;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
function startSpinSound(){ if (muted) return; ensureAudio(); stopSpinSound(); spinningOsc = audioCtx.createOscillator(); spinGain = audioCtx.createGain(); spinningOsc.type='square'; spinningOsc.frequency.value=440; spinGain.gain.value=0.03; spinningOsc.connect(spinGain).connect(audioCtx.destination); spinningOsc.start(); }
function modulateSpinSound(v){ if(!spinningOsc) return; const freq=300+Math.min(700,v*90); spinningOsc.frequency.setTargetAtTime(freq,audioCtx.currentTime,0.05); const g=0.015+Math.min(0.05,v*0.004); spinGain.gain.setTargetAtTime(muted?0:g,audioCtx.currentTime,0.05); }
function stopSpinSound(){ if(spinningOsc){try{spinningOsc.stop();}catch(e){} spinningOsc.disconnect(); spinningOsc=null;} if(spinGain){try{spinGain.disconnect();}catch(e){} spinGain=null;} }
function playWinSound(){ if(muted) return; ensureAudio(); const notes=[523.25,659.25,783.99,987.77]; const t0=audioCtx.currentTime; notes.forEach((f,i)=>{ const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='triangle'; o.frequency.value=f; g.gain.value=0.0001; o.connect(g).connect(audioCtx.destination); const st=t0+i*0.1; o.start(st); g.gain.linearRampToValueAtTime(0.06,st+0.02); g.gain.exponentialRampToValueAtTime(0.0001,st+0.28); o.stop(st+0.3); }); }
function playTickSound(){ if(muted) return; ensureAudio(); const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type='square'; o.frequency.value=1500; g.gain.value=0.0001; o.connect(g).connect(audioCtx.destination); const t=audioCtx.currentTime; o.start(t); g.gain.linearRampToValueAtTime(0.05,t+0.005); g.gain.exponentialRampToValueAtTime(0.0001,t+0.04); o.stop(t+0.05); }

function isFlexRound(n){ return flexRounds.has(n); }
function pickTargetIdx(){
  const round = spinNumber + 1;
  const flex = isFlexRound(round);
  let candidates = [];
  if (!flex){ candidates = NAMES.filter(n => winCounts[n] < MAX_PER); }
  else { candidates = NAMES.slice(); }
  if (candidates.length === 0){ candidates = NAMES.slice(); }
  const idx = Math.floor(Math.random() * candidates.length);
  const name = candidates[idx];
  return NAMES.indexOf(name);
}

let spinning=false, rafId=null;
function spin(){
  if (spinning) return;
  if (spinNumber >= MAX_SPINS){ alert('20ê²Œì„ì´ ëª¨ë‘ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤. RESET í›„ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.'); return; }
  spinning = true;
  resultEl.textContent = 'íšŒì „ ì¤‘â€¦';
  spinBtn.disabled = true; resetBtn.disabled = true;
  ensureAudio(); startSpinSound();

  const duration = 3000;
  const start = performance.now();
  const startAngle = angle;
  const targetIdx = pickTargetIdx();
  const twoPi = 2*Math.PI;
  const currentNorm = ((angle % twoPi)+twoPi)%twoPi;
  const desired = ((twoPi - (targetIdx*seg)) - seg/2 + twoPi) % twoPi;
  let delta = desired - currentNorm; if (delta < 0) delta += twoPi;
  const spins = 5 * twoPi;
  const endAngle = startAngle + spins + delta;

  lastTickIndex = null;
  const tick = (now) => {
    let t = (now - start) / duration; if (t > 1) t = 1;
    const eased = 1 - Math.pow(1 - t, 3);
    angle = startAngle + (endAngle - startAngle) * eased;

    const instVel = (endAngle - startAngle) / duration * (1 - t + 0.2) * 60;
    modulateSpinSound(instVel);
    const idxNow = getSelectedIndex();
    if (lastTickIndex === null) lastTickIndex = idxNow;
    if (idxNow !== lastTickIndex){ lastTickIndex = idxNow; playTickSound(); }

    drawWheel();

    if (t < 1){ rafId = requestAnimationFrame(tick); }
    else {
      spinning = false; spinBtn.disabled = false; resetBtn.disabled = false;
      stopSpinSound();
      const winner = NAMES[targetIdx];
      showResult(targetIdx);
      playWinSound();
      const round = ++spinNumber;
      const flex = isFlexRound(round);
      winCounts[winner] = (winCounts[winner]||0) + 1;
      if (flex) { flexSpinsLeft = Math.max(0, flexSpinsLeft - 1); }
      updateSidebar();
      if (spinNumber >= MAX_SPINS){ resultEl.innerHTML += ' Â· <span class="badge">ì´ 20ê²Œì„ ì¢…ë£Œ</span>'; }
    }
  };
  rafId = requestAnimationFrame(tick);
}

function reset(){
  if (spinning) return;
  angle = 0; drawWheel();
  resultEl.innerHTML = 'â€”';
  spinNumber = 0; flexSpinsLeft = FLEX_SPINS_TOTAL;
  for (const k of Object.keys(winCounts)) winCounts[k]=0;
  updateSidebar();
}

const spinBtn  = document.getElementById('spin');
const resetBtn = document.getElementById('reset');
const resultEl = document.getElementById('result');
spinBtn.addEventListener('click', spin);
resetBtn.addEventListener('click', reset);
const muteBtn = document.getElementById('mute');
muteBtn.addEventListener('click', ()=>{ muted = !muted; muteBtn.textContent = muted ? 'ğŸ”‡ ì†Œë¦¬ êº¼ì§' : 'ğŸ”Š ì†Œë¦¬ ì¼œì§'; if (muted) stopSpinSound(); });

const listEl = document.getElementById('nameList');
function updateSidebar(){
  listEl.innerHTML = '';
  NAMES.forEach((n,i)=>{
    const d = document.createElement('div');
    d.className = 'pill'; d.dataset.name = n;
    const count = winCounts[n]||0;
    const limit = (count >= MAX_PER) ? ' Â· ìƒí•œ ë„ë‹¬' : '';
    d.innerHTML = `<span>${String(i+1).padStart(2,'0')}. ${n}</span><small>${count}íšŒ${limit}</small>`;
    listEl.appendChild(d);
  });
}

function showResult(idx){
  const name = NAMES[idx];
  resultEl.innerHTML = `ì„ íƒ: <span class="badge">${name}</span>`;
  document.querySelectorAll('[data-name]').forEach(el=>{
    el.style.outline = (el.dataset.name === name) ? '2px solid #22c55e' : '0';
  });
}

drawWheel();
updateSidebar();
</script>
</body>
</html>
